{% extends 'base.html' %}

{% block title %}Saved Uploads{% endblock %}

{% block content %}
  <div class="py-3">
    <h3>Saved Uploads</h3>
    <p class="text-muted">Recent processed files (metadata stored in the app database).</p>

    <div class="mb-3">
      <a href="{{ url_for('home') }}" class="btn btn-outline-secondary btn-sm">Upload new CSV</a>
    </div>

    {% if uploads and uploads|length > 0 %}
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th>File</th>
              <th>Total</th>
              <th>Fraud</th>
              <th>Avg Risk</th>
              <th>Note</th>
              <th>Uploaded</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for u in uploads %}
              <tr>
                <td>{{ u.results_file }}</td>
                <td>{{ u.total }}</td>
                <td>{{ u.predicted_frauds }}</td>
                <td>{{ '%.2f'|format((u.avg_prob or 0) * 100) }}%</td>
                <td>{{ u.note or '' }}</td>
                <td>{{ u.created_at }}</td>
                <td>
                  <a href="{{ url_for('api_get_upload', results_file=u.results_file) }}" class="btn btn-sm btn-outline-primary">View JSON</a>
                  <a href="{{ url_for('download_upload', results_file=u.results_file) }}" class="btn btn-sm btn-outline-secondary">Download CSV</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted">No uploads recorded yet.</p>
    {% endif %}
  </div>

{% endblock %}
